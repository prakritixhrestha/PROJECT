{% extends 'custom_admin/base_admin_custom.html' %}

{% block title %}Payments Tracker{% endblock %}

{% block extra_head %}
<style>
    .status-badge {
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
    }
    .status-completed { background: #e8f5e9; color: #2e7d32; }
    .status-failed { background: #fce8e6; color: #c62828; }
    .status-pending { background: #fff8e1; color: #f57f17; }
</style>
{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px;">
    <h2 style="font-size: 24px; font-weight: 700;">Payments & Revenue</h2>
</div>

<!-- TOP METRICS -->
<div class="stats-grid">
    <div class="stat-card" style="border-bottom-color: var(--success);">
        <div class="stat-icon" style="background: #e8f5e9; color: var(--success);"><i class="fas fa-hand-holding-usd"></i></div>
        <div class="label">Total Revenue</div>
        <div class="value">Rs {{ total_rev }}</div>
    </div>
    <div class="stat-card" style="border-bottom-color: var(--warning);">
        <div class="stat-icon" style="background: #fff8e1; color: var(--warning);"><i class="fas fa-hourglass-half"></i></div>
        <div class="label">Pending Payments</div>
        <div class="value">{{ pending_pay }}</div>
    </div>
</div>

<div class="data-container">
    <table>
        <thead>
            <tr>
                <th>ORDER</th>
                <th>METHOD</th>
                <th>TRANSACTION ID</th>
                <th>AMOUNT</th>
                <th>STATUS</th>
                <th>DATE</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td style="font-weight: 700;">#{{ order.tracking_number|slice:":8"|upper }}</td>
                <td style="color: var(--text-muted);">{{ order.payment_method }}</td>
                <td style="font-family: monospace; font-size: 13px; color: var(--text-muted);">
                    {% with payment=order.payments.first %}
                        {{ payment.transaction_id|default:"-" }}
                    {% endwith %}
                </td>
                <td style="font-weight: 800; color: var(--text-main);">Rs {{ order.total_price }}</td>
                <td>
                    <span class="status-badge {% if order.payment_status == 'Completed' %}status-completed{% elif order.payment_status == 'Failed' %}status-failed{% else %}status-pending{% endif %}">
                        {{ order.payment_status|upper }}
                    </span>
                </td>
                <td style="color: var(--text-muted);">{{ order.order_date|date:"M d, Y H:i" }}</td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
</div>
{% endblock %}
